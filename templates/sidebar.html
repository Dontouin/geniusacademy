{% load static %}
{% load i18n %}

<style>
  /* --- Sidebar Glamorphique Futuriste --- */
  #side-nav {
      width: 280px;
      max-height: 100vh;
      overflow-y: auto;
      background: linear-gradient(160deg, #0a0a14, #1a1a2e);
      box-shadow: 8px 8px 25px #0d0d1a, -8px -8px 25px #23233d;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease-in-out;
  }
  #side-nav::-webkit-scrollbar { width: 8px; }
  #side-nav::-webkit-scrollbar-track { background: transparent; }
  #side-nav::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

  #side-nav .top-side {
      background: linear-gradient(120deg, rgba(58,58,122,0.6), rgba(20,20,40,0.6));
      box-shadow: inset 5px 5px 15px #0f0f1a, inset -5px -5px 15px #23233d;
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
      padding: 3rem 1rem 2rem 1rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
  }

  #side-nav .logo-container {
      position: relative;
      width: 180px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
  }

  #side-nav .logo-circle {
      width: 150px;
      height: 150px;
      background-color: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 4px 4px 12px #0f0f1a, -4px -4px 12px #23233d;
      transition: all 0.3s ease;
      position: relative;
      z-index: 2;
  }

  #side-nav .logo-circle::before {
      content: '';
      position: absolute;
      width: 170px;
      height: 170px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6c63ff, #ff6584, #6c63ff);
      z-index: -1;
      animation: rotateBorder 3s linear infinite;
  }

  #side-nav .logo-circle::after {
      content: '';
      position: absolute;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: linear-gradient(160deg, #0a0a14, #1a1a2e);
      z-index: -1;
  }

  @keyframes rotateBorder {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }

  #side-nav .logo-circle img { 
      width: 70%; 
      height: auto; 
      border-radius: 50%;
      transition: transform 0.3s ease;
  }

  #side-nav .logo-circle:hover img {
      transform: scale(1.05);
  }

  #side-nav ul { list-style: none; padding: 0 0.5rem; margin: 0; }
  #side-nav ul li { margin: 0.5rem 0; }
  #side-nav ul li a {
      display: flex; align-items: center; gap: 12px; padding: 10px 18px;
      border-radius: 15px; color: #d0d0ff; font-weight: 500; text-decoration: none;
      transition: all 0.2s ease-in-out; position: relative;
  }
  #side-nav ul li a i { width: 20px; text-align: center; color: #a0a0ff; transition: all 0.3s ease; }
  #side-nav ul li a:hover { background: rgba(255,255,255,0.05); box-shadow: 0 0 10px #6c63ff, 0 0 15px #6c63ff inset; color: #ffffff; }
  #side-nav ul li a:hover i { color: #fff; text-shadow: 0 0 6px #6c63ff, 0 0 12px #6c63ff; }
  #side-nav ul li.active a { background: rgba(255,255,255,0.1); box-shadow: inset 4px 4px 12px #0f0f1a, inset -4px -4px 12px #23233d, 0 0 8px #6c63ff; color: #ffffff; }
  #side-nav p.ms-3 { color: #9a9acc; margin-top: 1rem; margin-bottom: 0.5rem; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }

  #side-nav footer {
      background: linear-gradient(145deg, #0f0f1b, #1a1a2e);
      box-shadow: inset 2px 2px 10px #0d0d1a, inset -2px -2px 10px #23233d;
      border-radius: 15px;
      padding: 1rem;
      margin: 2rem 0 1rem 0;
      text-align: center;
      font-size: 0.75rem;
      color: #a0a0d0;
  }
  #side-nav footer select {
      background: transparent; border: 1px solid #555; border-radius: 5px; padding: 2px 5px; color: #d0d0ff;
  }
</style>

<div id="side-nav">
    <div class="main-menu">
        <div class="top-side">
            <div class="desktop-hide">
                <div class="toggle-btn" onclick="toggleSidebar()">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            
            <!-- Logo avec contour amélioré -->
            <div class="logo-container">
                <a href="{% url 'home' %}" class="logo-circle">
                    <img src="{% static 'img/logo.png' %}" alt="The Genius Academy">
                </a>
            </div>
            
            <p class="mt-2 small">
                <mark class="bg-secondary text-light rounded px-1">
                {% if request.user.is_superuser %}
                    Super Admin
                {% elif request.user.admin_role_name %}
                    {{ request.user.admin_role_name }}
                {% elif request.user.is_lecturer %}
                    Enseignant
                {% elif request.user.is_student %}
                    Étudiant
                {% elif request.user.is_parent %}
                    Parent
                {% elif request.user.is_other %}
                    Autre Utilisateur
                {% else %}
                    Utilisateur
                </mark>
                {% endif %}
            </p>
        </div>

        <ul>
            <!-- Accueil -->
            <p class="ms-3 small">{% trans 'Navigation Principale' %}</p>
            <li class="{% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                <a href="{% url 'home' %}"><i class="fas fa-home"></i> {% trans 'Accueil' %}</a>
            </li>

            <!-- Articles accessibles à tous -->
            <li class="{% if request.resolver_match.url_name == 'post' %}active{% endif %}">
                <a href="{% url 'post' %}"><i class="fas fa-newspaper"></i> {% trans 'Articles' %}</a>
            </li>

            <!-- Superuser / Admin -->
            {% if request.user.is_superuser %}
            <p class="ms-3 small">{% trans 'Administration' %}</p>
            <li class="{% if request.resolver_match.url_name == 'admin_panel' %}active{% endif %}">
                <a href="{% url 'admin_panel' %}"><i class="fas fa-user-shield"></i> {% trans 'Admin Panel' %}</a>
            </li>
            <li>
                <a href="/admin/"><i class="fas fa-cogs"></i>TGA Administration</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <a href="{% url 'dashboard' %}"><i class="fas fa-tachometer-alt"></i> {% trans 'Tableau de bord' %}</a>
            </li>
            
            <li class="{% if request.resolver_match.url_name == 'generate_calendar' %}active{% endif %}">
                <a href="{% url 'generate_calendar' %}"><i class="fas fa-calendar-plus"></i> {% trans 'Générer Calendrier' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'lecturer_list' %}active{% endif %}">
                <a href="{% url 'lecturer_list' %}"><i class="fas fa-chalkboard-teacher"></i> {% trans 'Enseignants' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'student_list' %}active{% endif %}">
                <a href="{% url 'student_list' %}"><i class="fas fa-user-graduate"></i> {% trans 'Étudiants' %}</a>
            </li>
            <!-- AJOUT: Liens pour Parents et Autres Utilisateurs -->
            <li class="{% if request.resolver_match.url_name == 'parent_list' %}active{% endif %}">
                <a href="{% url 'parent_list' %}"><i class="fas fa-users"></i> {% trans 'Parents' %}</a>
            </li>
            
            {% endif %}

            <!-- Lecturers -->
            {% if request.user.is_lecturer %}
            <p class="ms-3 small">{% trans 'Menu Enseignant' %}</p>
            <li class="{% if request.resolver_match.url_name == 'teacher_info_add' %}active{% endif %}">
                <a href="{% url 'teacher_info_add' %}"><i class="fas fa-file-alt"></i> {% trans 'Formulaires d\'inscription' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'teacher_info_pdf' %}active{% endif %}">
                <a href="{% url 'teacher_info_pdf' request.user.id %}"><i class="fas fa-file-pdf"></i> {% trans 'Exporter PDF' %}</a>
            </li>
            {% endif %}

            <!-- Autres Utilisateurs -->
            {% if request.user.is_other %}
            <p class="ms-3 small">{% trans 'Menu Utilisateur' %}</p>
            <li class="{% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                <a href="{% url 'profile' %}"><i class="fas fa-user"></i> {% trans 'Mon Profil' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'post' %}active{% endif %}">
                <a href="{% url 'post' %}"><i class="fas fa-newspaper"></i> {% trans 'Actualités' %}</a>
            </li>
            {% endif %}

            <!-- Compte -->
            <p class="ms-3 small">{% trans 'Compte' %}</p>
            <li class="{% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                <a href="{% url 'profile' %}"><i class="fas fa-user"></i> {% trans 'Profil' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'edit_profile' %}active{% endif %}">
                <a href="{% url 'edit_profile' %}"><i class="fas fa-cogs"></i> {% trans 'Paramètres du Compte' %}</a>
            </li>
            <li class="{% if request.resolver_match.url_name == 'change_password' %}active{% endif %}">
                <a href="{% url 'change_password' %}"><i class="fas fa-key"></i> {% trans 'Changer le Mot de Passe' %}</a>
            </li>

            <!-- Informations -->
            <p class="ms-3 small">{% trans 'Informations' %}</p>
            <li><a href="{% url 'about' %}"><i class="fas fa-info-circle"></i> {% trans 'À propos' %}</a></li>
            <li><a href="{% url 'services' %}"><i class="fas fa-concierge-bell"></i> {% trans 'Services' %}</a></li>
            <li><a href="{% url 'faq' %}"><i class="fas fa-question-circle"></i> {% trans 'FAQ' %}</a></li>
            <li><a href="{% url 'contact' %}"><i class="fas fa-envelope"></i> {% trans 'Contact' %}</a></li>
            <li><a href="{% url 'testimonials' %}"><i class="fas fa-star"></i> {% trans 'Témoignages' %}</a></li>
            <li><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> {% trans 'Déconnexion' %}</a></li>
        </ul>
    </div>

    <footer>
        <form action="{% url 'set_language' %}" method="post" id="lang-form" class="mb-2">
            {% csrf_token %}
            <input name="next" type="hidden" value="{{ redirect_to }}">
            <select name="language" id="lang-select" class="form-select form-select-sm">
                {% get_current_language as LANGUAGE_CODE %}
                {% get_available_languages as LANGUAGES %}
                {% get_language_info_list for LANGUAGES as languages %}
                {% for language in languages %}
                    <option value="{{ language.code }}" {% if language.code == LANGUAGE_CODE %}selected{% endif %}>
                        {{ language.name_local }} ({{ language.code }})
                    </option>
                {% endfor %}
            </select>
        </form>
        <p>THE GENIUS ACADEMY &copy; <script>document.write(new Date().getFullYear());</script></p>
    </footer>
</div>

{% block js %}
<script>
document.getElementById("lang-select").addEventListener("change", function() {
    document.getElementById("lang-form").submit();
});
</script>
{% endblock js %}